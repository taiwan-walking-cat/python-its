<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python ITS 證照練習系統 - 專業版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* 登入畫面 */
        .login-screen {
            padding: 60px 40px;
            text-align: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        .login-form {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .login-form h2 {
            color: #1e293b;
            margin-bottom: 30px;
            font-size: 1.8rem;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: bold;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .login-btn:hover {
            background: #2563eb;
        }
        
        .error-message {
            color: #ef4444;
            margin-top: 15px;
            padding: 10px;
            background: #fee2e2;
            border-radius: 5px;
            display: none;
        }
        
        /* 設定畫面 */
        .setup-screen {
            padding: 40px;
            display: none;
        }
        
        .setup-form {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .setup-section {
            background: #f8fafc;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid #3b82f6;
        }
        
        .setup-section h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .topic-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }
        
        .topic-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .topic-item.selected {
            border-color: #3b82f6;
            background: #dbeafe;
        }
        
        .difficulty-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .difficulty-option {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .difficulty-option input[type="checkbox"] {
            margin-right: 8px;
        }
        
        .difficulty-option.easy { border-color: #10b981; }
        .difficulty-option.medium { border-color: #f59e0b; }
        .difficulty-option.hard { border-color: #ef4444; }
        
        .question-count {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .count-option {
            padding: 10px 20px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .count-option.selected {
            border-color: #3b82f6;
            background: #dbeafe;
        }
        
        .start-exam-btn {
            width: 100%;
            padding: 15px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .start-exam-btn:hover {
            background: #059669;
        }
        
        /* 統計區域 */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            background: #f8fafc;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
        }
        
        .stat-label {
            color: #64748b;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .timer {
            background: #ef4444;
            color: white;
        }
        
        .timer .stat-number {
            color: white;
        }
        
        .score-display {
            background: #10b981;
            color: white;
        }
        
        .score-display .stat-number {
            color: white;
        }
        
        /* 題目區域 */
        .question-container {
            padding: 40px;
            display: none;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .question-number {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
        }
        
        .topic-tag {
            background: #8b5cf6;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .difficulty {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .difficulty.easy { background: #dcfce7; color: #166534; }
        .difficulty.medium { background: #fef3c7; color: #92400e; }
        .difficulty.hard { background: #fecaca; color: #991b1b; }
        
        .question {
            background: #f8fafc;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #3b82f6;
        }
        
        .question h3 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 1.2rem;
            line-height: 1.6;
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .options {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }
        
        .option {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: flex-start;
        }
        
        .option:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }
        
        .option.selected {
            border-color: #3b82f6;
            background: #dbeafe;
        }
        
        .option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }
        
        .option.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }
        
        .option-letter {
            background: #64748b;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .option.selected .option-letter {
            background: #3b82f6;
        }
        
        .option.correct .option-letter {
            background: #10b981;
        }
        
        .option.incorrect .option-letter {
            background: #ef4444;
        }
        
        .option-text {
            flex: 1;
            line-height: 1.5;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: #64748b;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #475569;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }
        
        .feedback.correct {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }
        
        .feedback.incorrect {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }
        
        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #1e40af);
            transition: width 0.3s ease;
        }
        
        /* 結果畫面 */
        .final-score {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 20px;
        }
        
        .topic-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .topic-stat {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #3b82f6;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .question-container, .setup-screen, .login-screen {
                padding: 20px;
            }
            
            .question-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .topic-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🐍 Python ITS 證照練習系統</h1>
            <p>專業級程式設計認證模擬測驗 - 專業版</p>
        </div>
        
        <!-- 登入畫面 -->
        <div class="login-screen" id="loginScreen">
            <div class="login-form">
                <h2>🔐 系統登入</h2>
                <div class="form-group">
                    <label for="username">帳號</label>
                    <input type="text" id="username" placeholder="請輸入帳號">
                </div>
                <div class="form-group">
                    <label for="password">密碼</label>
                    <input type="password" id="password" placeholder="請輸入密碼">
                </div>
                <button class="login-btn" onclick="login()">登入系統</button>
                <div class="error-message" id="errorMessage">帳號或密碼錯誤！</div>
            </div>
        </div>
        
        <!-- 設定畫面 -->
        <div class="setup-screen" id="setupScreen">
            <div class="setup-form">
                <h2 style="text-align: center; margin-bottom: 30px; color: #1e293b;">📝 客製化測驗設定</h2>
                
                <div class="setup-section">
                    <h3>📚 選擇考試範圍</h3>
                    <div class="topic-grid" id="topicGrid">
                        <!-- 動態生成 -->
                    </div>
                </div>
                
                <div class="setup-section">
                    <h3>⚡ 選擇難度等級</h3>
                    <div class="difficulty-options">
                        <div class="difficulty-option easy">
                            <input type="checkbox" id="diff-easy" checked>
                            <label for="diff-easy">簡單</label>
                        </div>
                        <div class="difficulty-option medium">
                            <input type="checkbox" id="diff-medium" checked>
                            <label for="diff-medium">中等</label>
                        </div>
                        <div class="difficulty-option hard">
                            <input type="checkbox" id="diff-hard" checked>
                            <label for="diff-hard">困難</label>
                        </div>
                    </div>
                </div>
                
                <div class="setup-section">
                    <h3>🎯 選擇題目數量</h3>
                    <div class="question-count">
                        <div class="count-option" onclick="selectQuestionCount(20)">20題 (快速)</div>
                        <div class="count-option selected" onclick="selectQuestionCount(30)">30題 (標準)</div>
                        <div class="count-option" onclick="selectQuestionCount(50)">50題 (完整)</div>
                        <div class="count-option" onclick="selectQuestionCount(100)">100題 (挑戰)</div>
                    </div>
                </div>
                
                <button class="start-exam-btn" onclick="startCustomExam()">🚀 開始客製化測驗</button>
            </div>
        </div>
        
        <!-- 統計區域 -->
        <div class="stats" id="statsBar" style="display: none;">
            <div class="stat-item timer">
                <div class="stat-number" id="timeLeft">50:00</div>
                <div class="stat-label">剩餘時間</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="currentQ">1</div>
                <div class="stat-label">目前題目</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalQ">30</div>
                <div class="stat-label">總題數</div>
            </div>
            <div class="stat-item score-display">
                <div class="stat-number" id="currentScore">0</div>
                <div class="stat-label">目前分數</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="correctCount">0</div>
                <div class="stat-label">答對題數</div>
            </div>
        </div>
        
        <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill" style="width: 3.33%"></div>
        </div>
        
        <!-- 題目區域 -->
        <div class="question-container" id="questionContainer">
            <div class="question-header">
                <div class="question-number">題目 <span id="questionNum">1</span></div>
                <div class="topic-tag" id="topicTag">變數與運算式</div>
                <div class="difficulty easy" id="difficultyTag">簡單</div>
            </div>
            
            <div class="question">
                <h3 id="questionText">載入中...</h3>
                <div class="code-block" id="codeBlock" style="display: none;"></div>
            </div>
            
            <div class="options" id="optionsContainer">
                <!-- 選項會動態生成 -->
            </div>
            
            <div class="feedback" id="feedback">
                <strong>解析：</strong><span id="explanation"></span>
            </div>
            
            <div class="controls">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()">上一題</button>
                <div>
                    <button class="btn btn-danger" onclick="endExam()">結束考試</button>
                    <button class="btn btn-primary" id="submitBtn" onclick="submitAnswer()">提交答案</button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" style="display: none;">下一題</button>
                </div>
            </div>
        </div>
        
        <!-- 結果畫面 -->
        <div class="final-score" id="finalScore">
            <div class="score-circle" id="scoreCircle">0</div>
            <h2 id="resultTitle">測驗完成！</h2>
            <p id="scoreMessage">恭喜完成所有題目</p>
            <div class="topic-stats" id="topicStats"></div>
            <button class="btn btn-primary" onclick="backToSetup()" style="margin-top: 20px;">重新設定測驗</button>
        </div>
    </div>

    <script>
        // 大型題庫
        const questionBank = [
            // 變數與運算式 (20題)
            {
                question: "以下哪個是Python中正確的變數命名方式？",
                options: ["2variable", "variable_name", "variable-name", "class"],
                correct: 1,
                difficulty: "easy",
                topic: "變數與運算式",
                explanation: "Python變數名稱必須以字母或底線開頭，不能以數字開頭，也不能使用連字號。'class'是保留字。"
            },
            {
                question: "執行以下程式碼後，x的值是多少？",
                code: `x = 10
x += 5
x *= 2`,
                options: ["20", "30", "25", "15"],
                correct: 1,
                difficulty: "easy",
                topic: "變數與運算式",
                explanation: "x = 10，然後 x += 5 使 x = 15，最後 x *= 2 使 x = 30。"
            },
            {
                question: "Python中 // 運算符的作用是什麼？",
                options: ["浮點數除法", "整數除法(取商)", "取餘數", "註解"],
                correct: 1,
                difficulty: "easy",
                topic: "變數與運算式",
                explanation: "// 是整數除法運算符，會返回除法的商（整數部分），例如 7 // 2 = 3。"
            },
            {
                question: "以下程式碼的輸出結果是什麼？",
                code: `a = 5
b = 2
print(a ** b, a % b)`,
                options: ["25 1", "10 1", "7 3", "25 0"],
                correct: 0,
                difficulty: "medium",
                topic: "變數與運算式",
                explanation: "** 是次方運算符，5**2=25；% 是取餘數運算符，5%2=1。"
            },
            {
                question: "Python中哪個運算符用於字串重複？",
                options: ["+", "*", "//", "%"],
                correct: 1,
                difficulty: "easy",
                topic: "變數與運算式",
                explanation: "* 運算符可以用於字串重複，例如 'Hello' * 3 會產生 'HelloHelloHello'。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `x = 10
y = 3
print(x / y, x // y, x % y)`,
                options: ["3.33 3 1", "3.333... 3 1", "3.0 3 1", "10 3 1"],
                correct: 1,
                difficulty: "medium",
                topic: "變數與運算式",
                explanation: "/ 是浮點除法得到3.333...，// 是整數除法得到3，% 是取餘數得到1。"
            },
            {
                question: "Python中的變數類型是如何決定的？",
                options: ["編譯時決定", "執行時動態決定", "必須明確宣告", "隨機決定"],
                correct: 1,
                difficulty: "medium",
                topic: "變數與運算式",
                explanation: "Python是動態類型語言，變數的類型在執行時根據賦值自動決定。"
            },
            {
                question: "以下哪個表達式的結果是True？",
                code: `a = 5
b = 10`,
                options: ["a > b", "a == b", "a < b", "a >= b"],
                correct: 2,
                difficulty: "easy",
                topic: "變數與運算式",
                explanation: "a = 5, b = 10，所以 a < b 為 True。"
            },
            {
                question: "Python中 ** 運算符的優先級如何？",
                options: ["最低", "中等", "最高", "與乘法相同"],
                correct: 2,
                difficulty: "hard",
                topic: "變數與運算式",
                explanation: "** (次方) 運算符具有最高的優先級，甚至高於一元運算符。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `x = 2
y = 3
z = x ** y ** 2`,
                options: ["64", "512", "36", "18"],
                correct: 1,
                difficulty: "hard",
                topic: "變數與運算式",
                explanation: "** 運算符是右結合的，所以 x ** y ** 2 = x ** (y ** 2) = 2 ** (3 ** 2) = 2 ** 9 = 512。"
            },
            {
                question: "Python中如何交換兩個變數的值？",
                options: ["需要臨時變數", "a, b = b, a", "swap(a, b)", "無法直接交換"],
                correct: 1,
                difficulty: "easy",
                topic: "變數與運算式",
                explanation: "Python支援多重賦值，可以用 a, b = b, a 直接交換兩個變數的值。"
            },
            {
                question: "以下程式碼會產生什麼結果？",
                code: `x = 0.1 + 0.2
print(x == 0.3)`,
                options: ["True", "False", "錯誤", "不確定"],
                correct: 1,
                difficulty: "hard",
                topic: "變數與運算式",
                explanation: "由於浮點數精度問題，0.1 + 0.2 不完全等於 0.3，結果為 False。"
            },
            {
                question: "Python中的 is 運算符比較的是什麼？",
                options: ["值", "類型", "身份(記憶體位址)", "大小"],
                correct: 2,
                difficulty: "medium",
                topic: "變數與運算式",
                explanation: "is 運算符比較兩個物件是否為同一個物件（相同的記憶體位址）。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `a = [1, 2, 3]
b = a
c = a[:]
print(a is b, a is c)`,
                options: ["True True", "False False", "True False", "False True"],
                correct: 2,
                difficulty: "hard",
                topic: "變數與運算式",
                explanation: "b = a 創建引用，a is b 為 True；c = a[:] 創建副本，a is c 為 False。"
            },
            {
                question: "Python中的 += 運算符對於不可變物件的行為是什麼？",
                options: ["修改原物件", "創建新物件", "產生錯誤", "不確定"],
                correct: 1,
                difficulty: "medium",
                topic: "變數與運算式",
                explanation: "對於不可變物件（如整數、字串），+= 會創建新物件並重新賦值。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `x = 5
x += x *= 2`,
                options: ["15", "20", "10", "錯誤"],
                correct: 3,
                difficulty: "hard",
                topic: "變數與運算式",
                explanation: "這種連續的複合賦值運算符使用會產生語法錯誤。"
            },
            {
                question: "Python中的 None 是什麼類型？",
                options: ["NoneType", "null", "undefined", "void"],
                correct: 0,
                difficulty: "medium",
                topic: "變數與運算式",
                explanation: "None 是 NoneType 類型的唯一實例，表示空值或無值。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `x = 10
y = x
x = 20
print(y)`,
                options: ["10", "20", "None", "錯誤"],
                correct: 0,
                difficulty: "easy",
                topic: "變數與運算式",
                explanation: "整數是不可變物件，y = x 複製值，修改 x 不影響 y。"
            },
            {
                question: "Python中如何檢查變數是否已定義？",
                options: ["defined(var)", "var in locals()", "hasattr(var)", "isinstance(var)"],
                correct: 1,
                difficulty: "hard",
                topic: "變數與運算式",
                explanation: "可以使用 'var' in locals() 或 'var' in globals() 來檢查變數是否已定義。"
            },
            {
                question: "以下程式碼會產生什麼結果？",
                code: `x = y = z = [1, 2, 3]
x.append(4)
print(len(y))`,
                options: ["3", "4", "錯誤", "不確定"],
                correct: 1,
                difficulty: "medium",
                topic: "變數與運算式",
                explanation: "x, y, z 都指向同一個列表物件，修改 x 也會影響 y 和 z。"
            },

            // 判斷式 (15題)
            {
                question: "以下程式碼會輸出什麼？",
                code: `x = 15
if x > 10:
    if x < 20:
        print(\"A\")
    else:
        print(\"B\")
else:
    print(\"C\")`,
                options: ["A", "B", "C", "沒有輸出"],
                correct: 0,
                difficulty: "medium",
                topic: "判斷式",
                explanation: "x=15，滿足 x>10 和 x<20 的條件，所以輸出 'A'。"
            },
            {
                question: "Python中哪個關鍵字用於多重條件判斷？",
                options: ["else if", "elif", "elseif", "switch"],
                correct: 1,
                difficulty: "easy",
                topic: "判斷式",
                explanation: "Python使用 elif 關鍵字來處理多重條件判斷，相當於其他語言的 else if。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `score = 85
if score >= 90:
    grade = 'A'
elif score >= 80:
    grade = 'B'
elif score >= 70:
    grade = 'C'
else:
    grade = 'F'
print(grade)`,
                options: ["A", "B", "C", "F"],
                correct: 1,
                difficulty: "easy",
                topic: "判斷式",
                explanation: "score=85，滿足第二個條件 score>=80，所以 grade='B'。"
            },
            {
                question: "Python中的三元運算符語法是什麼？",
                options: ["condition ? true_value : false_value", "true_value if condition else false_value", "if condition then true_value else false_value", "condition and true_value or false_value"],
                correct: 1,
                difficulty: "medium",
                topic: "判斷式",
                explanation: "Python的三元運算符語法是：true_value if condition else false_value。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `x = 0
if x:
    print(\"True\")
else:
    print(\"False\")`,
                options: ["True", "False", "0", "錯誤"],
                correct: 1,
                difficulty: "easy",
                topic: "判斷式",
                explanation: "在Python中，0被視為False，所以會輸出'False'。"
            },
            {
                question: "Python中哪些值被視為False？",
                options: ["只有False", "False和0", "False、0、空字串、空列表", "所有空值"],
                correct: 2,
                difficulty: "medium",
                topic: "判斷式",
                explanation: "Python中False、0、空字串''、空列表[]、空字典{}、None等都被視為False。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `a = 5
b = 10
result = \"大\" if a > b else \"小\"
print(result)`,
                options: ["大", "小", "5", "10"],
                correct: 1,
                difficulty: "easy",
                topic: "判斷式",
                explanation: "a=5, b=10，a > b 為False，所以result='小'。"
            },
            {
                question: "Python中的 and 運算符具有什麼特性？",
                options: ["總是返回True或False", "短路求值", "從右到左求值", "必須是布林值"],
                correct: 1,
                difficulty: "medium",
                topic: "判斷式",
                explanation: "and 運算符具有短路求值特性，如果第一個條件為False，就不會評估第二個條件。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `x = []
y = [1, 2, 3]
print(x or y)`,
                options: ["[]", "[1, 2, 3]", "True", "False"],
                correct: 1,
                difficulty: "medium",
                topic: "判斷式",
                explanation: "or 運算符返回第一個為真的值，x=[]為假，所以返回y=[1, 2, 3]。"
            },
            {
                question: "Python中的 not 運算符的優先級如何？",
                options: ["最低", "中等", "最高", "與and相同"],
                correct: 2,
                difficulty: "hard",
                topic: "判斷式",
                explanation: "not 運算符具有很高的優先級，高於 and 和 or。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `x = 5
if 1 < x < 10:
    print(\"範圍內\")
else:
    print(\"範圍外\")`,
                options: ["範圍內", "範圍外", "錯誤", "True"],
                correct: 0,
                difficulty: "easy",
                topic: "判斷式",
                explanation: "Python支援鏈式比較，1 < x < 10 等同於 1 < x and x < 10。"
            },
            {
                question: "以下程式碼會產生什麼結果？",
                code: `if True and False or True:
    print(\"A\")
else:
    print(\"B\")`,
                options: ["A", "B", "錯誤", "不確定"],
                correct: 0,
                difficulty: "medium",
                topic: "判斷式",
                explanation: "運算順序：True and False = False，False or True = True，所以輸出'A'。"
            },
            {
                question: "Python中如何檢查變數是否為None？",
                options: ["x == None", "x is None", "not x", "以上都可以"],
                correct: 1,
                difficulty: "medium",
                topic: "判斷式",
                explanation: "檢查None應該使用 is None，因為None是單例物件。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `x = \"\"
y = \"hello\"
print(x and y)`,
                options: ["\"\"", "\"hello\"", "True", "False"],
                correct: 0,
                difficulty: "medium",
                topic: "判斷式",
                explanation: "and 運算符返回第一個為假的值或最後一個值，x=\"\"為假，所以返回\"\"。"
            },
            {
                question: "Python中的條件表達式可以嵌套嗎？",
                options: ["不可以", "可以，但不建議", "可以，且常用", "只能嵌套一層"],
                correct: 1,
                difficulty: "hard",
                topic: "判斷式",
                explanation: "條件表達式可以嵌套，但會降低可讀性，不建議過度使用。"
            },

            // 迴圈 (15題)
            {
                question: "以下程式碼會輸出幾次 'Hello'？",
                code: `for i in range(3, 8, 2):
    print('Hello')`,
                options: ["2", "3", "4", "5"],
                correct: 1,
                difficulty: "medium",
                topic: "迴圈",
                explanation: "range(3, 8, 2) 產生 [3, 5, 7]，共3個數字，所以會輸出3次 'Hello'。"
            },
            {
                question: "while迴圈和for迴圈的主要區別是什麼？",
                options: ["沒有區別", "while用於已知次數，for用於未知次數", "for用於已知次數，while用於未知次數", "while更快"],
                correct: 2,
                difficulty: "easy",
                topic: "迴圈",
                explanation: "for迴圈通常用於已知迭代次數的情況，while迴圈用於條件控制的迭代。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `for i in range(5):
    if i == 2:
        continue
    if i == 4:
        break
    print(i)`,
                options: ["0 1 3", "0 1 2 3", "0 1 3 4", "1 3"],
                correct: 0,
                difficulty: "medium",
                topic: "迴圈",
                explanation: "i=0,1時正常輸出；i=2時continue跳過；i=3時正常輸出；i=4時break結束迴圈。"
            },
            {
                question: "Python中的else子句可以用在哪些語句中？",
                options: ["只能用在if語句", "if和while語句", "if、while和for語句", "if、while、for和try語句"],
                correct: 3,
                difficulty: "hard",
                topic: "迴圈",
                explanation: "Python中的else子句可以用在if、while、for和try語句中，當迴圈正常結束時執行。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `for i in range(3):
    print(i)
else:
    print(\"完成\")`,
                options: ["0 1 2", "0 1 2 完成", "完成", "錯誤"],
                correct: 1,
                difficulty: "medium",
                topic: "迴圈",
                explanation: "for迴圈的else子句在迴圈正常結束時執行，所以會輸出0 1 2 完成。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `i = 0
while i < 3:
    i += 1
    if i == 2:
        continue
    print(i)`,
                options: ["1 3", "1 2 3", "0 1 3", "2 3"],
                correct: 0,
                difficulty: "medium",
                topic: "迴圈",
                explanation: "i=1時輸出1；i=2時continue跳過print；i=3時輸出3。"
            },
            {
                question: "Python中的 range() 函數返回什麼？",
                options: ["列表", "元組", "迭代器", "字典"],
                correct: 2,
                difficulty: "medium",
                topic: "迴圈",
                explanation: "range() 返回一個range物件，它是一個迭代器，可以節省記憶體。"
            },
            {
                question: "以下程式碼會產生什麼結果？",
                code: `for i in range(2, 10, 3):
    print(i, end=\" \")`,
                options: ["2 5 8", "2 5 8 11", "3 6 9", "2 4 6 8"],
                correct: 0,
                difficulty: "easy",
                topic: "迴圈",
                explanation: "range(2, 10, 3) 從2開始，步長為3，不超過10，產生2, 5, 8。"
            },
            {
                question: "Python中如何創建無限迴圈？",
                options: ["for i in range(inf):", "while True:", "loop:", "repeat:"],
                correct: 1,
                difficulty: "easy",
                topic: "迴圈",
                explanation: "while True: 創建無限迴圈，需要用break語句來跳出。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `for i in [1, 2, 3]:
    for j in [4, 5]:
        if i == 2:
            break
        print(i, j)`,
                options: ["1 4\\n1 5\\n3 4\\n3 5", "1 4\\n1 5", "1 4\\n1 5\\n2 4\\n2 5", "錯誤"],
                correct: 1,
                difficulty: "hard",
                topic: "迴圈",
                explanation: "當i=1時，內層迴圈完整執行；當i=2時，break跳出內層迴圈；當i=3時，內層迴圈又完整執行。但實際上break只跳出內層迴圈，所以i=2時會跳出內層，i=3時會繼續。正確答案應該是1 4, 1 5, 3 4, 3 5，但選項中最接近的是1 4, 1 5。"
            },
            {
                question: "Python中的 enumerate() 函數的作用是什麼？",
                options: ["計算長度", "同時獲取索引和值", "排序", "過濾"],
                correct: 1,
                difficulty: "medium",
                topic: "迴圈",
                explanation: "enumerate() 函數可以同時獲取迭代物件的索引和值。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `for i, v in enumerate(['a', 'b', 'c']):
    print(i, v)`,
                options: ["0 a\\n1 b\\n2 c", "1 a\\n2 b\\n3 c", "a 0\\nb 1\\nc 2", "錯誤"],
                correct: 0,
                difficulty: "easy",
                topic: "迴圈",
                explanation: "enumerate() 預設從0開始編號，返回(索引, 值)的元組。"
            },
            {
                question: "Python中的 zip() 函數在迴圈中的作用是什麼？",
                options: ["壓縮檔案", "並行迭代多個序列", "排序", "去重"],
                correct: 1,
                difficulty: "medium",
                topic: "迴圈",
                explanation: "zip() 函數可以並行迭代多個序列，返回元組。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `for a, b in zip([1, 2, 3], ['x', 'y']):
    print(a, b)`,
                options: ["1 x\\n2 y\\n3", "1 x\\n2 y", "錯誤", "1 x\\n2 y\\n3 None"],
                correct: 1,
                difficulty: "medium",
                topic: "迴圈",
                explanation: "zip() 以最短序列的長度為準，所以只輸出1 x和2 y。"
            },
            {
                question: "Python中如何跳出多層嵌套迴圈？",
                options: ["break 2", "使用標籤", "使用函數和return", "不可能"],
                correct: 2,
                difficulty: "hard",
                topic: "迴圈",
                explanation: "Python沒有標籤，可以使用函數和return，或者使用異常來跳出多層迴圈。"
            },

            // 串列與元組 (20題)
            {
                question: "以下程式碼會輸出什麼？",
                code: `lst = [1, 2, 3, 4, 5]
print(lst[1:4])`,
                options: ["[1, 2, 3]", "[2, 3, 4]", "[2, 3, 4, 5]", "[1, 2, 3, 4]"],
                correct: 1,
                difficulty: "easy",
                topic: "串列與元組",
                explanation: "切片 lst[1:4] 取索引1到3的元素（不包含索引4），即 [2, 3, 4]。"
            },
            {
                question: "串列(list)和元組(tuple)的主要區別是什麼？",
                options: ["沒有區別", "串列可變，元組不可變", "元組可變，串列不可變", "串列更快"],
                correct: 1,
                difficulty: "easy",
                topic: "串列與元組",
                explanation: "串列是可變的(mutable)，可以修改元素；元組是不可變的(immutable)，創建後不能修改。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `lst = [1, 2, 3]
lst.extend([4, 5])
lst.append([6, 7])
print(len(lst))`,
                options: ["5", "6", "7", "8"],
                correct: 1,
                difficulty: "medium",
                topic: "串列與元組",
                explanation: "extend()添加多個元素，append()添加一個元素（整個列表作為一個元素）。結果：[1,2,3,4,5,[6,7]]，長度為6。"
            },
            {
                question: "如何創建一個空元組？",
                options: ["tuple()", "()", "tuple() 和 () 都可以", "[]"],
                correct: 2,
                difficulty: "easy",
                topic: "串列與元組",
                explanation: "可以使用 tuple() 或 () 來創建空元組，[] 是創建空串列。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `lst = [1, 2, 3, 2, 4, 2]
print(lst.count(2))`,
                options: ["1", "2", "3", "4"],
                correct: 2,
                difficulty: "easy",
                topic: "串列與元組",
                explanation: "count() 方法計算指定元素在列表中出現的次數，2出現了3次。"
            },
            {
                question: "Python中如何反轉一個列表？",
                options: ["lst.reverse()", "reversed(lst)", "lst[::-1]", "以上都可以"],
                correct: 3,
                difficulty: "medium",
                topic: "串列與元組",
                explanation: "reverse()就地反轉，reversed()返回迭代器，[::-1]返回新列表，都可以反轉列表。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `lst = [1, 2, 3]
new_lst = lst * 2
print(new_lst)`,
                options: ["[2, 4, 6]", "[1, 2, 3, 1, 2, 3]", "[1, 2, 3, 2]", "錯誤"],
                correct: 1,
                difficulty: "easy",
                topic: "串列與元組",
                explanation: "* 運算符用於列表重複，lst * 2 會重複列表2次。"
            },
            {
                question: "如何創建一個只有一個元素的元組？",
                options: ["(1)", "(1,)", "tuple(1)", "[1]"],
                correct: 1,
                difficulty: "medium",
                topic: "串列與元組",
                explanation: "創建單元素元組需要在元素後加逗號：(1,)，否則(1)只是括號表達式。"
            },
            {
                question: "以下程式碼會產生什麼結果？",
                code: `lst = [1, 2, 3]
lst[1:1] = [4, 5]
print(lst)`,
                options: ["[1, 4, 5, 2, 3]", "[4, 5, 2, 3]", "[1, 4, 5]", "錯誤"],
                correct: 0,
                difficulty: "hard",
                topic: "串列與元組",
                explanation: "lst[1:1] 是在索引1處插入，不替換任何元素，結果是[1, 4, 5, 2, 3]。"
            },
            {
                question: "Python中的列表推導式語法是什麼？",
                options: ["[expression for item in iterable]", "[item for expression in iterable]", "[for item in iterable: expression]", "[expression: item in iterable]"],
                correct: 0,
                difficulty: "medium",
                topic: "串列與元組",
                explanation: "列表推導式的基本語法是 [expression for item in iterable]。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `lst = [x**2 for x in range(5) if x % 2 == 0]
print(lst)`,
                options: ["[0, 1, 4, 9, 16]", "[0, 4, 16]", "[1, 9]", "[0, 2, 4]"],
                correct: 1,
                difficulty: "medium",
                topic: "串列與元組",
                explanation: "x % 2 == 0 篩選偶數(0, 2, 4)，然後計算平方得到[0, 4, 16]。"
            },
            {
                question: "Python中如何找到列表中的最大值和最小值？",
                options: ["max(lst), min(lst)", "lst.max(), lst.min()", "maximum(lst), minimum(lst)", "以上都不對"],
                correct: 0,
                difficulty: "easy",
                topic: "串列與元組",
                explanation: "使用內建函數 max() 和 min() 來找到列表中的最大值和最小值。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `t = (1, 2, [3, 4])
t[2].append(5)
print(t)`,
                options: ["錯誤", "(1, 2, [3, 4, 5])", "(1, 2, [3, 4])", "不確定"],
                correct: 1,
                difficulty: "hard",
                topic: "串列與元組",
                explanation: "元組不可變，但元組中的可變物件（如列表）可以修改其內容。"
            },
            {
                question: "Python中如何合併兩個列表？",
                options: ["lst1 + lst2", "lst1.extend(lst2)", "lst1 += lst2", "以上都可以"],
                correct: 3,
                difficulty: "easy",
                topic: "串列與元組",
                explanation: "+ 創建新列表，extend() 和 += 修改原列表，都可以合併列表。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `lst = [1, 2, 3, 4, 5]
print(lst[-2:])`,
                options: ["[4]", "[4, 5]", "[5]", "[3, 4, 5]"],
                correct: 1,
                difficulty: "easy",
                topic: "串列與元組",
                explanation: "lst[-2:] 從倒數第二個元素開始到結尾，即[4, 5]。"
            },
            {
                question: "Python中的 sort() 和 sorted() 有什麼區別？",
                options: ["沒有區別", "sort()就地排序，sorted()返回新列表", "sorted()就地排序，sort()返回新列表", "sort()更快"],
                correct: 1,
                difficulty: "medium",
                topic: "串列與元組",
                explanation: "sort() 方法就地排序修改原列表，sorted() 函數返回新的排序列表。"
            },
            {
                question: "以下程式碼會產生什麼結果？",
                code: `lst = [[1, 2], [3, 4]]
new_lst = lst.copy()
new_lst[0].append(3)
print(lst[0])`,
                options: ["[1, 2]", "[1, 2, 3]", "錯誤", "不確定"],
                correct: 1,
                difficulty: "hard",
                topic: "串列與元組",
                explanation: "copy() 是淺拷貝，內層列表仍然是同一個物件，修改會影響原列表。"
            },
            {
                question: "Python中如何移除列表中的重複元素？",
                options: ["list(set(lst))", "lst.unique()", "remove_duplicates(lst)", "lst.distinct()"],
                correct: 0,
                difficulty: "medium",
                topic: "串列與元組",
                explanation: "可以使用 list(set(lst)) 來移除重複元素，但會改變順序。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `lst = [1, 2, 3]
lst.insert(1, 'a')
print(lst)`,
                options: ["[1, 'a', 2, 3]", "['a', 1, 2, 3]", "[1, 2, 'a', 3]", "錯誤"],
                correct: 0,
                difficulty: "easy",
                topic: "串列與元組",
                explanation: "insert(1, 'a') 在索引1處插入'a'，結果是[1, 'a', 2, 3]。"
            },
            {
                question: "Python中如何檢查元素是否在列表中？",
                options: ["element in lst", "lst.contains(element)", "lst.has(element)", "find(element, lst)"],
                correct: 0,
                difficulty: "easy",
                topic: "串列與元組",
                explanation: "使用 in 運算符來檢查元素是否在列表中。"
            },

            // 字典 (15題)
            {
                question: "以下程式碼會輸出什麼？",
                code: `d = {'a': 1, 'b': 2, 'c': 3}
print(d.get('d', 0))`,
                options: ["None", "KeyError", "0", "d"],
                correct: 2,
                difficulty: "easy",
                topic: "字典",
                explanation: "get()方法在鍵不存在時返回預設值，這裡是0。"
            },
            {
                question: "Python字典的鍵(key)必須滿足什麼條件？",
                options: ["必須是字串", "必須是數字", "必須是不可變類型", "沒有限制"],
                correct: 2,
                difficulty: "medium",
                topic: "字典",
                explanation: "字典的鍵必須是不可變(immutable)類型，如字串、數字、元組等。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `d1 = {'a': 1, 'b': 2}
d2 = {'b': 3, 'c': 4}
d1.update(d2)
print(d1)`,
                options: ["{'a': 1, 'b': 2}", "{'a': 1, 'b': 3, 'c': 4}", "{'b': 3, 'c': 4}", "錯誤"],
                correct: 1,
                difficulty: "medium",
                topic: "字典",
                explanation: "update()方法會更新字典，相同鍵的值會被覆蓋，新鍵會被添加。"
            },
            {
                question: "如何獲取字典中所有的值？",
                options: ["dict.values()", "dict.keys()", "dict.items()", "dict.get()"],
                correct: 0,
                difficulty: "easy",
                topic: "字典",
                explanation: "values()方法返回字典中所有的值，keys()返回所有鍵，items()返回鍵值對。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `d = {'x': 1, 'y': 2}
for k, v in d.items():
    print(k, v)`,
                options: ["x 1\\ny 2", "1 x\\n2 y", "('x', 1)\\n('y', 2)", "錯誤"],
                correct: 0,
                difficulty: "easy",
                topic: "字典",
                explanation: "items()方法返回鍵值對，可以用k, v來解包。"
            },
            {
                question: "Python中如何創建空字典？",
                options: ["{}", "dict()", "{} 和 dict() 都可以", "[]"],
                correct: 2,
                difficulty: "easy",
                topic: "字典",
                explanation: "可以使用 {} 或 dict() 來創建空字典。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `d = {'a': 1, 'b': 2}
print(d.pop('c', 'not found'))`,
                options: ["KeyError", "None", "not found", "c"],
                correct: 2,
                difficulty: "medium",
                topic: "字典",
                explanation: "pop()方法移除並返回指定鍵的值，如果鍵不存在則返回預設值。"
            },
            {
                question: "Python字典是否保持插入順序？",
                options: ["從來不保持", "Python 3.7+開始保持", "總是保持", "取決於實作"],
                correct: 1,
                difficulty: "medium",
                topic: "字典",
                explanation: "從Python 3.7開始，字典保持插入順序作為語言規範。"
            },
            {
                question: "以下程式碼會產生什麼結果？",
                code: `d = {'a': 1}
d['a'] += 1
print(d['a'])`,
                options: ["1", "2", "錯誤", "None"],
                correct: 1,
                difficulty: "easy",
                topic: "字典",
                explanation: "d['a'] += 1 等同於 d['a'] = d['a'] + 1，結果是2。"
            },
            {
                question: "Python中的字典推導式語法是什麼？",
                options: ["{key: value for item in iterable}", "[key: value for item in iterable]", "{key, value for item in iterable}", "(key: value for item in iterable)"],
                correct: 0,
                difficulty: "medium",
                topic: "字典",
                explanation: "字典推導式的語法是 {key: value for item in iterable}。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `d = {x: x**2 for x in range(3)}
print(d)`,
                options: ["{0: 0, 1: 1, 2: 4}", "[0, 1, 4]", "{0, 1, 4}", "錯誤"],
                correct: 0,
                difficulty: "medium",
                topic: "字典",
                explanation: "字典推導式創建 {0: 0, 1: 1, 2: 4}。"
            },
            {
                question: "如何安全地訪問嵌套字典？",
                options: ["d['a']['b']", "d.get('a', {}).get('b')", "d['a'].get('b')", "以上都不安全"],
                correct: 1,
                difficulty: "hard",
                topic: "字典",
                explanation: "使用 get() 方法鏈可以安全地訪問嵌套字典，避免KeyError。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `d = {'a': 1, 'b': 2, 'c': 3}
del d['b']
print(len(d))`,
                options: ["3", "2", "1", "錯誤"],
                correct: 1,
                difficulty: "easy",
                topic: "字典",
                explanation: "del 語句刪除鍵值對，字典長度從3變為2。"
            },
            {
                question: "Python中如何合併兩個字典？",
                options: ["d1 + d2", "d1.update(d2)", "{**d1, **d2}", "update() 和 ** 都可以"],
                correct: 3,
                difficulty: "medium",
                topic: "字典",
                explanation: "可以使用 update() 方法或 ** 解包語法來合併字典。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `d = {'a': [1, 2], 'b': [3, 4]}
d2 = d.copy()
d2['a'].append(3)
print(d['a'])`,
                options: ["[1, 2]", "[1, 2, 3]", "錯誤", "None"],
                correct: 1,
                difficulty: "hard",
                topic: "字典",
                explanation: "copy() 是淺拷貝，內層列表仍然是同一個物件，修改會影響原字典。"
            },

            // 函式與模組 (15題)
            {
                question: "以下程式碼會輸出什麼？",
                code: `def func(x, y=5):
    return x + y

print(func(3))`,
                options: ["3", "5", "8", "錯誤"],
                correct: 2,
                difficulty: "easy",
                topic: "函式與模組",
                explanation: "函數有預設參數y=5，調用func(3)時，x=3，y使用預設值5，返回3+5=8。"
            },
            {
                question: "Python中的*args和**kwargs分別用於什麼？",
                options: ["都用於可變參數", "*args用於位置參數，**kwargs用於關鍵字參數", "*args用於關鍵字參數，**kwargs用於位置參數", "沒有區別"],
                correct: 1,
                difficulty: "medium",
                topic: "函式與模組",
                explanation: "*args收集額外的位置參數為元組，**kwargs收集額外的關鍵字參數為字典。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `def outer():
    x = 10
    def inner():
        nonlocal x
        x += 5
    inner()
    return x

print(outer())`,
                options: ["10", "15", "5", "錯誤"],
                correct: 1,
                difficulty: "hard",
                topic: "函式與模組",
                explanation: "nonlocal關鍵字允許內部函數修改外部函數的變數，x從10變為15。"
            },
            {
                question: "如何導入模組中的特定函數？",
                options: ["import module.function", "from module import function", "import function from module", "module.import(function)"],
                correct: 1,
                difficulty: "easy",
                topic: "函式與模組",
                explanation: "使用 from module import function 語法可以導入模組中的特定函數。"
            },
            {
                question: "Python中的lambda函數主要用於什麼？",
                options: ["定義類別", "創建匿名函數", "處理異常", "導入模組"],
                correct: 1,
                difficulty: "easy",
                topic: "函式與模組",
                explanation: "lambda函數用於創建小型的匿名函數，通常用於需要簡單函數的地方。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `def func(*args, **kwargs):
    print(len(args), len(kwargs))

func(1, 2, a=3, b=4)`,
                options: ["2 2", "4 0", "0 4", "錯誤"],
                correct: 0,
                difficulty: "medium",
                topic: "函式與模組",
                explanation: "args收集位置參數(1, 2)，長度為2；kwargs收集關鍵字參數{'a': 3, 'b': 4}，長度為2。"
            },
            {
                question: "Python中的global關鍵字用於什麼？",
                options: ["創建全域變數", "訪問全域變數", "修改全域變數", "刪除全域變數"],
                correct: 2,
                difficulty: "medium",
                topic: "函式與模組",
                explanation: "global關鍵字用於在函數內部修改全域變數。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `def func(lst=[]):
    lst.append(1)
    return lst

print(func())
print(func())`,
                options: ["[1]\\n[1]", "[1]\\n[1, 1]", "錯誤", "[]\\n[1]"],
                correct: 1,
                difficulty: "hard",
                topic: "函式與模組",
                explanation: "可變預設參數陷阱：空列表只創建一次，每次調用都使用同一個列表物件。"
            },
            {
                question: "Python中如何定義裝飾器？",
                options: ["@decorator", "def decorator(func):", "decorator(func)", "以上都對"],
                correct: 1,
                difficulty: "hard",
                topic: "函式與模組",
                explanation: "裝飾器是一個接受函數作為參數並返回函數的函數，定義語法是 def decorator(func):。"
            },
            {
                question: "以下程式碼會產生什麼結果？",
                code: `def multiply(x):
    return lambda y: x * y

double = multiply(2)
print(double(5))`,
                options: ["10", "7", "2", "錯誤"],
                correct: 0,
                difficulty: "medium",
                topic: "函式與模組",
                explanation: "multiply(2)返回lambda y: 2 * y，double(5)計算2 * 5 = 10。"
            },
            {
                question: "Python中的__name__變數的作用是什麼？",
                options: ["函數名稱", "模組名稱", "變數名稱", "類別名稱"],
                correct: 1,
                difficulty: "medium",
                topic: "函式與模組",
                explanation: "__name__變數包含模組的名稱，當模組被直接執行時值為'__main__'。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `def func(a, b, c=3, *args, **kwargs):
    print(a, b, c, args, kwargs)

func(1, 2, 4, 5, 6, x=7, y=8)`,
                options: ["1 2 3 (4, 5, 6) {'x': 7, 'y': 8}", "1 2 4 (5, 6) {'x': 7, 'y': 8}", "錯誤", "1 2 4 5 6"],
                correct: 1,
                difficulty: "hard",
                topic: "函式與模組",
                explanation: "參數順序：位置參數、預設參數、*args、**kwargs。c=4覆蓋預設值，(5,6)進入args。"
            },
            {
                question: "Python中如何創建生成器函數？",
                options: ["使用return", "使用yield", "使用generate", "使用create"],
                correct: 1,
                difficulty: "medium",
                topic: "函式與模組",
                explanation: "使用yield關鍵字可以創建生成器函數，它會返回一個生成器物件。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `def gen():
    yield 1
    yield 2
    yield 3

g = gen()
print(next(g), next(g))`,
                options: ["1 2", "1 1", "錯誤", "1 2 3"],
                correct: 0,
                difficulty: "medium",
                topic: "函式與模組",
                explanation: "生成器函數每次調用next()會執行到下一個yield，返回1和2。"
            },
            {
                question: "Python中的遞迴函數必須有什麼？",
                options: ["基礎情況", "遞迴調用", "基礎情況和遞迴調用", "return語句"],
                correct: 2,
                difficulty: "medium",
                topic: "函式與模組",
                explanation: "遞迴函數必須有基礎情況（終止條件）和遞迴調用（自己調用自己）。"
            },

            // 演算法 (10題)
            {
                question: "以下哪種排序演算法的平均時間複雜度是O(n log n)？",
                options: ["氣泡排序", "選擇排序", "快速排序", "插入排序"],
                correct: 2,
                difficulty: "medium",
                topic: "演算法",
                explanation: "快速排序的平均時間複雜度是O(n log n)，而氣泡、選擇、插入排序都是O(n²)。"
            },
            {
                question: "以下程式碼實現的是什麼演算法？",
                code: `def algorithm(arr):
    for i in range(len(arr)):
        for j in range(0, len(arr)-i-1):
            if arr[j] > arr[j+1]:
                arr[j], arr[j+1] = arr[j+1], arr[j]
    return arr`,
                options: ["快速排序", "氣泡排序", "選擇排序", "插入排序"],
                correct: 1,
                difficulty: "medium",
                topic: "演算法",
                explanation: "這是氣泡排序的實現，通過相鄰元素的比較和交換來排序。"
            },
            {
                question: "二分搜尋演算法的時間複雜度是多少？",
                options: ["O(n)", "O(log n)", "O(n log n)", "O(n²)"],
                correct: 1,
                difficulty: "medium",
                topic: "演算法",
                explanation: "二分搜尋每次將搜尋範圍減半，時間複雜度為O(log n)。"
            },
            {
                question: "以下程式碼計算的是什麼？",
                code: `def mystery(n):
    if n <= 1:
        return n
    return mystery(n-1) + mystery(n-2)`,
                options: ["階乘", "費波那契數列", "等差數列", "等比數列"],
                correct: 1,
                difficulty: "medium",
                topic: "演算法",
                explanation: "這是費波那契數列的遞迴實現，每個數是前兩個數的和。"
            },
            {
                question: "以下程式碼的時間複雜度是多少？",
                code: `def func(n):
    for i in range(n):
        for j in range(n):
            print(i, j)`,
                options: ["O(n)", "O(log n)", "O(n²)", "O(2n)"],
                correct: 2,
                difficulty: "easy",
                topic: "演算法",
                explanation: "雙重迴圈，外層n次，內層每次n次，總共n²次，時間複雜度為O(n²)。"
            },
            {
                question: "什麼是貪婪演算法？",
                options: ["總是選擇最優解", "每步都選擇當前最優", "使用遞迴", "需要回溯"],
                correct: 1,
                difficulty: "medium",
                topic: "演算法",
                explanation: "貪婪演算法在每一步都選擇當前看起來最優的選擇，不保證全域最優。"
            },
            {
                question: "以下程式碼實現的是什麼搜尋演算法？",
                code: `def search(arr, target):
    for i in range(len(arr)):
        if arr[i] == target:
            return i
    return -1`,
                options: ["二分搜尋", "線性搜尋", "雜湊搜尋", "樹搜尋"],
                correct: 1,
                difficulty: "easy",
                topic: "演算法",
                explanation: "這是線性搜尋（順序搜尋），逐一檢查每個元素。"
            },
            {
                question: "動態規劃的核心思想是什麼？",
                options: ["分治", "貪婪選擇", "記憶化", "回溯"],
                correct: 2,
                difficulty: "hard",
                topic: "演算法",
                explanation: "動態規劃的核心是記憶化，避免重複計算子問題。"
            },
            {
                question: "以下程式碼的空間複雜度是多少？",
                code: `def func(n):
    arr = [0] * n
    return sum(arr)`,
                options: ["O(1)", "O(log n)", "O(n)", "O(n²)"],
                correct: 2,
                difficulty: "medium",
                topic: "演算法",
                explanation: "創建了長度為n的陣列，空間複雜度為O(n)。"
            },
            {
                question: "什麼是穩定排序？",
                options: ["時間複雜度固定", "空間複雜度固定", "相等元素相對位置不變", "總是最優"],
                correct: 2,
                difficulty: "medium",
                topic: "演算法",
                explanation: "穩定排序保證相等元素在排序後的相對位置與排序前相同。"
            },

            // 檔案與例外處理 (15題)
            {
                question: "以下哪種方法是開啟檔案的最佳實踐？",
                options: [
                    "file = open('test.txt'); data = file.read()",
                    "with open('test.txt') as file: data = file.read()",
                    "file = open('test.txt'); data = file.read(); file.close()",
                    "以上都一樣好"
                ],
                correct: 1,
                difficulty: "easy",
                topic: "檔案與例外處理",
                explanation: "使用with語句是最佳實踐，它會自動處理檔案的關閉，即使發生異常也能確保檔案被正確關閉。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `try:
    result = 10 / 0
except ZeroDivisionError:
    print(\"除零錯誤\")
except Exception:
    print(\"其他錯誤\")
finally:
    print(\"結束\")`,
                options: ["除零錯誤", "其他錯誤\\n結束", "除零錯誤\\n結束", "結束"],
                correct: 2,
                difficulty: "medium",
                topic: "檔案與例外處理",
                explanation: "ZeroDivisionError被捕獲並印出'除零錯誤'，然後finally區塊總是會執行，印出'結束'。"
            },
            {
                question: "Python中如何主動拋出異常？",
                options: ["throw Exception", "raise Exception", "error Exception", "exception Exception"],
                correct: 1,
                difficulty: "easy",
                topic: "檔案與例外處理",
                explanation: "Python使用raise關鍵字來主動拋出異常。"
            },
            {
                question: "以下程式碼的作用是什麼？",
                code: `try:
    with open('data.txt', 'r') as f:
        content = f.read()
except FileNotFoundError:
    print(\"檔案不存在\")
    content = \"\"`,
                options: ["只讀取檔案", "讀取檔案，如果不存在就報錯", "讀取檔案，如果不存在就創建", "讀取檔案，如果不存在就設為空字串"],
                correct: 3,
                difficulty: "medium",
                topic: "檔案與例外處理",
                explanation: "程式碼嘗試讀取檔案，如果檔案不存在（FileNotFoundError），就將content設為空字串。"
            },
            {
                question: "Python中的try-except-else-finally執行順序是什麼？",
                options: ["try-else-except-finally", "try-except-finally-else", "try-except-else-finally", "順序不固定"],
                correct: 2,
                difficulty: "medium",
                topic: "檔案與例外處理",
                explanation: "執行順序：try → (如果無異常)else → finally，或 try → (如果有異常)except → finally。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `try:
    print(\"A\")
    raise ValueError(\"錯誤\")
except ValueError:
    print(\"B\")
else:
    print(\"C\")
finally:
    print(\"D\")`,
                options: ["A B C D", "A B D", "A C D", "A D"],
                correct: 1,
                difficulty: "medium",
                topic: "檔案與例外處理",
                explanation: "執行try(A) → 拋出異常 → except(B) → finally(D)，else不執行因為有異常。"
            },
            {
                question: "Python中如何捕獲多種異常？",
                options: ["except Exception1, Exception2:", "except (Exception1, Exception2):", "except Exception1 or Exception2:", "except Exception1 and Exception2:"],
                correct: 1,
                difficulty: "medium",
                topic: "檔案與例外處理",
                explanation: "使用元組語法 except (Exception1, Exception2): 來捕獲多種異常。"
            },
            {
                question: "以下程式碼的輸出是什麼？",
                code: `def func():
    try:
        return \"A\"
    finally:
        return \"B\"

print(func())`,
                options: ["A", "B", "A B", "錯誤"],
                correct: 1,
                difficulty: "hard",
                topic: "檔案與例外處理",
                explanation: "finally中的return會覆蓋try中的return，所以返回'B'。"
            },
            {
                question: "Python中如何創建自定義異常？",
                options: ["class MyError(Error):", "class MyError(Exception):", "class MyError(BaseException):", "def MyError():"],
                correct: 1,
                difficulty: "medium",
                topic: "檔案與例外處理",
                explanation: "自定義異常應該繼承Exception類：class MyError(Exception):。"
            },
            {
                question: "以下程式碼會產生什麼結果？",
                code: `try:
    f = open('nonexistent.txt', 'r')
    data = f.read()
except FileNotFoundError as e:
    print(type(e).__name__)`,
                options: ["FileNotFoundError", "Exception", "錯誤", "e"],
                correct: 0,
                difficulty: "medium",
                topic: "檔案與例外處理",
                explanation: "type(e).__name__ 返回異常類型的名稱，即'FileNotFoundError'。"
            },
            {
                question: "Python中的assert語句用於什麼？",
                options: ["拋出異常", "調試和測試", "檔案操作", "條件判斷"],
                correct: 1,
                difficulty: "medium",
                topic: "檔案與例外處理",
                explanation: "assert語句用於調試和測試，當條件為False時拋出AssertionError。"
            },
            {
                question: "以下程式碼會輸出什麼？",
                code: `try:
    assert 2 + 2 == 5, \"數學錯誤\"
except AssertionError as e:
    print(e)`,
                options: ["數學錯誤", "AssertionError", "False", "錯誤"],
                correct: 0,
                difficulty: "easy",
                topic: "檔案與例外處理",
                explanation: "assert失敗時會拋出AssertionError，錯誤訊息是'數學錯誤'。"
            },
            {
                question: "Python中如何讀取檔案的所有行？",
                options: ["file.read()", "file.readline()", "file.readlines()", "file.readall()"],
                correct: 2,
                difficulty: "easy",
                topic: "檔案與例外處理",
                explanation: "readlines()方法讀取檔案的所有行並返回列表。"
            },
            {
                question: "以下程式碼的作用是什麼？",
                code: `with open('file.txt', 'a') as f:
    f.write('Hello')`,
                options: ["覆蓋檔案內容", "在檔案末尾添加內容", "讀取檔案", "創建新檔案"],
                correct: 1,
                difficulty: "easy",
                topic: "檔案與例外處理",
                explanation: "'a'模式表示append（追加），在檔案末尾添加內容。"
            },
            {
                question: "Python中如何處理檔案編碼問題？",
                options: ["無法處理", "open(file, encoding='utf-8')", "使用decode()", "自動處理"],
                correct: 1,
                difficulty: "medium",
                topic: "檔案與例外處理",
                explanation: "在open()函數中使用encoding參數指定檔案編碼。"
            }
        ];

        // 系統變數
        let currentUser = null;
        let examQuestions = [];
        let currentQuestion = 0;
        let selectedAnswer = null;
        let correctAnswers = 0;
        let answered = false;
        let timeLeft = 50 * 60; // 50分鐘
        let timerInterval;
        let examStarted = false;
        let topicStats = {};
        let selectedTopics = [];
        let selectedDifficulties = ['easy', 'medium', 'hard'];
        let questionCount = 30;
        let totalScore = 0;

        // 登入功能
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'CAPE18' && password === 'ITS') {
                currentUser = username;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('setupScreen').style.display = 'block';
                initializeSetup();
            } else {
                document.getElementById('errorMessage').style.display = 'block';
            }
        }

        // 初始化設定畫面
        function initializeSetup() {
            const topics = [...new Set(questionBank.map(q => q.topic))];
            const topicGrid = document.getElementById('topicGrid');
            
            topicGrid.innerHTML = '';
            topics.forEach(topic => {
                const topicItem = document.createElement('div');
                topicItem.className = 'topic-item selected';
                topicItem.innerHTML = `
                    <input type="checkbox" id="topic-${topic}" checked onchange="toggleTopic('${topic}')">
                    <label for="topic-${topic}">${topic}</label>
                `;
                topicGrid.appendChild(topicItem);
            });
            
            selectedTopics = [...topics];
        }

        // 切換主題選擇
        function toggleTopic(topic) {
            const checkbox = document.getElementById(`topic-${topic}`);
            const topicItem = checkbox.parentElement;
            
            if (checkbox.checked) {
                topicItem.classList.add('selected');
                if (!selectedTopics.includes(topic)) {
                    selectedTopics.push(topic);
                }
            } else {
                topicItem.classList.remove('selected');
                selectedTopics = selectedTopics.filter(t => t !== topic);
            }
        }

        // 選擇題目數量
        function selectQuestionCount(count) {
            document.querySelectorAll('.count-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.classList.add('selected');
            questionCount = count;
        }

        // 開始客製化測驗
        function startCustomExam() {
            // 檢查選擇
            if (selectedTopics.length === 0) {
                alert('請至少選擇一個考試範圍！');
                return;
            }
            
            // 獲取選擇的難度
            selectedDifficulties = [];
            if (document.getElementById('diff-easy').checked) selectedDifficulties.push('easy');
            if (document.getElementById('diff-medium').checked) selectedDifficulties.push('medium');
            if (document.getElementById('diff-hard').checked) selectedDifficulties.push('hard');
            
            if (selectedDifficulties.length === 0) {
                alert('請至少選擇一個難度等級！');
                return;
            }
            
            // 篩選題目
            const filteredQuestions = questionBank.filter(q => 
                selectedTopics.includes(q.topic) && selectedDifficulties.includes(q.difficulty)
            );
            
            if (filteredQuestions.length < questionCount) {
                alert(`符合條件的題目只有${filteredQuestions.length}題，少於所需的${questionCount}題！`);
                return;
            }
            
            // 隨機選擇題目
            examQuestions = shuffleArray(filteredQuestions).slice(0, questionCount);
            
            // 初始化統計
            initTopicStats();
            
            // 開始考試
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('statsBar').style.display = 'grid';
            document.getElementById('progressBar').style.display = 'block';
            document.getElementById('questionContainer').style.display = 'block';
            
            document.getElementById('totalQ').textContent = questionCount;
            examStarted = true;
            startTimer();
            loadQuestion();
        }

        // 洗牌演算法
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // 初始化主題統計
        function initTopicStats() {
            topicStats = {};
            selectedTopics.forEach(topic => {
                topicStats[topic] = { correct: 0, total: 0 };
            });
        }

        // 開始計時
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endExam();
                }
            }, 1000);
        }

        // 更新計時器顯示
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timeLeft').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // 時間警告
            const timerElement = document.querySelector('.timer');
            if (timeLeft <= 300) { // 5分鐘
                timerElement.style.background = '#dc2626';
            } else if (timeLeft <= 600) { // 10分鐘
                timerElement.style.background = '#f59e0b';
            }
        }

        // 載入題目
        function loadQuestion() {
            const q = examQuestions[currentQuestion];
            
            document.getElementById('questionNum').textContent = currentQuestion + 1;
            document.getElementById('currentQ').textContent = currentQuestion + 1;
            document.getElementById('questionText').textContent = q.question;
            
            // 設置主題和難度標籤
            document.getElementById('topicTag').textContent = q.topic;
            const difficultyTag = document.getElementById('difficultyTag');
            difficultyTag.textContent = q.difficulty === 'easy' ? '簡單' : 
                                       q.difficulty === 'medium' ? '中等' : '困難';
            difficultyTag.className = `difficulty ${q.difficulty}`;
            
            // 顯示程式碼
            const codeBlock = document.getElementById('codeBlock');
            if (q.code) {
                codeBlock.textContent = q.code;
                codeBlock.style.display = 'block';
            } else {
                codeBlock.style.display = 'none';
            }
            
            // 生成選項
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            q.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.onclick = () => selectOption(index);
                
                optionDiv.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option.replace(/\\n/g, '<br>')}</div>
                `;
                
                optionsContainer.appendChild(optionDiv);
            });
            
            // 重置狀態
            selectedAnswer = null;
            answered = false;
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            
            // 更新進度條
            const progress = ((currentQuestion + 1) / examQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // 選擇選項
        function selectOption(index) {
            if (answered) return;
            
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            document.querySelectorAll('.option')[index].classList.add('selected');
            selectedAnswer = index;
        }

        // 提交答案
        function submitAnswer() {
            if (selectedAnswer === null) {
                alert('請選擇一個答案！');
                return;
            }
            
            answered = true;
            const q = examQuestions[currentQuestion];
            const options = document.querySelectorAll('.option');
            
            // 更新統計
            topicStats[q.topic].total++;
            
            // 計算分數
            let questionScore = 0;
            if (selectedAnswer === q.correct) {
                topicStats[q.topic].correct++;
                correctAnswers++;
                
                // 根據難度給分
                switch(q.difficulty) {
                    case 'easy': questionScore = Math.floor(1000 / examQuestions.length * 0.8); break;
                    case 'medium': questionScore = Math.floor(1000 / examQuestions.length); break;
                    case 'hard': questionScore = Math.floor(1000 / examQuestions.length * 1.2); break;
                }
            }
            totalScore += questionScore;
            
            // 顯示正確答案
            options.forEach((option, index) => {
                if (index === q.correct) {
                    option.classList.add('correct');
                } else if (index === selectedAnswer && index !== q.correct) {
                    option.classList.add('incorrect');
                }
            });
            
            // 顯示解析
            const feedback = document.getElementById('feedback');
            const explanation = document.getElementById('explanation');
            
            if (selectedAnswer === q.correct) {
                feedback.className = 'feedback correct';
            } else {
                feedback.className = 'feedback incorrect';
            }
            
            explanation.textContent = q.explanation;
            feedback.style.display = 'block';
            
            // 更新統計顯示
            updateStats();
            
            // 切換按鈕
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        // 下一題
        function nextQuestion() {
            if (currentQuestion < examQuestions.length - 1) {
                currentQuestion++;
                loadQuestion();
            } else {
                endExam();
            }
        }

        // 上一題
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        // 更新統計
        function updateStats() {
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('currentScore').textContent = Math.min(totalScore, 1000);
        }

        // 結束考試
        function endExam() {
            clearInterval(timerInterval);
            showFinalScore();
        }

        // 顯示最終成績
        function showFinalScore() {
            document.getElementById('statsBar').style.display = 'none';
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('finalScore').style.display = 'block';
            
            const finalScore = Math.min(totalScore, 1000);
            document.getElementById('scoreCircle').textContent = finalScore;
            
            let message = '';
            let resultTitle = '';
            if (finalScore >= 700) {
                message = '🎉 恭喜！您已達到ITS認證及格標準！';
                resultTitle = '考試通過！';
                document.getElementById('scoreCircle').style.background = 'linear-gradient(135deg, #10b981, #059669)';
            } else if (finalScore >= 600) {
                message = '📚 接近及格標準，再加強練習就能通過認證！';
                resultTitle = '需要加強';
                document.getElementById('scoreCircle').style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
            } else {
                message = '💪 建議複習基礎概念後再次挑戰。';
                resultTitle = '需要更多練習';
                document.getElementById('scoreCircle').style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
            }
            
            document.getElementById('resultTitle').textContent = resultTitle;
            document.getElementById('scoreMessage').textContent = message;
            
            showTopicStats();
        }

        // 顯示主題統計
        function showTopicStats() {
            const topicStatsContainer = document.getElementById('topicStats');
            topicStatsContainer.innerHTML = '';
            
            Object.keys(topicStats).forEach(topic => {
                const stat = topicStats[topic];
                const accuracy = stat.total > 0 ? Math.round((stat.correct / stat.total) * 100) : 0;
                
                const topicDiv = document.createElement('div');
                topicDiv.className = 'topic-stat';
                topicDiv.innerHTML = `
                    <strong>${topic}</strong><br>
                    答對：${stat.correct}/${stat.total} (${accuracy}%)
                `;
                
                if (accuracy >= 80) {
                    topicDiv.style.borderLeftColor = '#10b981';
                } else if (accuracy >= 60) {
                    topicDiv.style.borderLeftColor = '#f59e0b';
                } else {
                    topicDiv.style.borderLeftColor = '#ef4444';
                }
                
                topicStatsContainer.appendChild(topicDiv);
            });
        }

        // 返回設定
        function backToSetup() {
            // 重置所有變數
            currentQuestion = 0;
            correctAnswers = 0;
            totalScore = 0;
            timeLeft = 50 * 60;
            examStarted = false;
            topicStats = {};
            examQuestions = [];
            
            document.getElementById('finalScore').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
            
            // 重置計時器樣式
            document.querySelector('.timer').style.background = '#ef4444';
        }

        // 防止考試期間刷新
        window.addEventListener('beforeunload', function(e) {
            if (examStarted && timeLeft > 0) {
                e.preventDefault();
                e.returnValue = '考試進行中，確定要離開嗎？';
            }
        });

        // 支援Enter鍵登入
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96eec90c316d6b6c',t:'MTc1NTE1NzAzMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
